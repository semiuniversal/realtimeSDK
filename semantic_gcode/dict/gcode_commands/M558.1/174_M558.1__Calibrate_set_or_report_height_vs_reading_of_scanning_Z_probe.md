## M558.1: Calibrate, set or report height vs reading of scanning Z probe

Supported from RRF 3.5.0

### Parameters

- **Knn** (optional) probe number, default 0. The probe must be of a scanning type (see M558).

- **Sn.n** Height to scan above and below the trigger height, in mm

- **Ann.n** (optional) Linear coefficient of the output, in mm per count

- **Bnn.n** (optional, ignored unless A parameter is also present, default 0.0) Quadratic coefficient of the output, in mm^2 per count

- **Cnn.n** (optional, ignored unless A parameter is also present, default 0.0) Cubic coefficient of the output, in mm^3 per count

### Usage

M558.1 Knn Sn.n M558.1 Knn Ann.n Bnn.n Cnn.n M558.1 Knn

### Description

M558.1 is used to define the coefficients that calculate the height from the scanning Z probe reading. This can be done either by setting these coefficients directly, or by instigating a calibration move. Both are done with M558.1. If at least the A parameter is present, then the equation to calculate the actual height of the Z probe is set to this:

height = trigger_height + A \* (probe_reading - probe_threshold) + B \* (probe_reading - probe_threshold)^2 + C \* (probe_reading - probe_threshold)^3

where trigger_height is the G31 Z parameter, and probe_threshold (or trigger value) is the G31 P parameter. Note that the probe_threshold (G31 P parameter trigger value) is set for the trigger_height (G31 Z parameter) during M588.1 calibration.

### Order dependency

Before M558.1 is used the probe must be defined as a scanning Z probe using M558, the probe trigger height must be set using G31, the axes must have been homed, the sensor must be over the bed surface and not too close to the edges of the bed, and the sensor drive current should have been set using M558.2 if necessary.

### Examples

M558.1 K1 S1.7 ; Use probe 1 to calibrate probe, scanning 1.7mm above and below trigger height set by G31 Z parameter M558.1 K1 A-2.865e-4 B2.598e-10 C2.937e-17 ; Set coefficients for probe 1 M558.1 K1 ; report coefficients in use on probe 1

In the first example, if G31 Z2 was set, the probe would calibrate in the range Z3.7 to Z0.3.

### Notes

- If the A parameter is not present but the S parameter is present then the probe is raised or lowered to (trigger_height + S_parameter) at the current XY position, then readings are taken as the probe is gradually lowered to (trigger_height - S_parameter). The readings are used to compute, store and report new values of A, B, C and the trigger threshold.

- If neither the A nor the S parameter is present, the current A, B and C values are reported, eg

M558.1 K1 Scanning probe coefficients \[1.840e-1, -2.865e-4, 2.598e-10, 2.937e-17\]

- The first coefficient is the difference in reading from the target reading at the trigger height during calibration, and automatically generated.

- The second, third and fourth coefficients are the A, B and C parameters.

See also: Scanning Z Probe calibration

