## M586.4: Configure MQTT Client

Supported from firmware version 3.5, on WiFi-equipped Duet 3 series main boards running in standalone mode. Requires the WiFi interface to be running WiFi server version 2.1 or later. Supported in SBC mode and Duet 3 series with ethernet networks from 3.6.0

### Parameters

- **U"username"** Username for authenticating with MQTT broker that does not allow anonymous login (not needed if broker supports anonymous login)

- **K"password"** Password for authenticating with MQTT broker that does not allow anonymous login (only processed if the U parameter is also present; not needed if broker supports anonymous login).

- **C"client-id"** Set fixed MQTT client ID, used with persistent sessions (see notes).

- **W"will-message"** Set message to send to subscribers when MQTT client does not disconnect from the broker gracefully (such as sudden shutdown of the board, network loss, etc). If not set, no message is sent to subscribers.

- **T"will-topic"** The topic to publish the will message under (only processed if the W parameter is also present).

- **Q"will-qos"** QOS level of the will message, from 0 to 2 (only processed if the W parameter is also present, optional). Defaults to 0 if not specified.

- **R"will-retain"** Set retain flag of the will message, 1 or 0 (only processed if the W parameter is also present, optional). Defaults to 0 if not specified.

- **S"subscribe-topic"** Add topic to subscribe to.

- **On** Max QOS level of the subscription, from 0 to 2 (only processed if the S parameter is also present).

### Example

#### In standalone/SBC mode (RRF 3.6:

M586.4 C"duet" ; Set client ID M586.4 U"username" K"password" ; Set authentication credentials M586.4 S"subscription" O2 ; Subscribe to topic M586 P4 R1884 H192.168.10.244 S1 ; Enable MQTT protocol/client M118 P6 S"message" T"topic" ; Publish message (See M118 for more details) M586 P4 S0 ; Disable MQTT protocol/client; disconnects from broker gracefully.

#### In SBC mode:

M586.4 C"duet" U"username" K"password" S"subscription" O2 ; configure MQTT parameters M586 P4 R1884 H192.168.10.244 S1 ; Enable MQTT protocol/client M118 P6 S"message" T"topic" ; Publish message (See M118 for more details) M586 P4 S0 ; Disable MQTT protocol/client; disconnects from broker

### Notes

- In Standalone mode:

  - In RRF 3.5 the C parameter is not supported. It is supported in RRF 3.6.

  - Parameters can be set in a single line, or in multiple lines.

- In SBC mode:

  - In RRF 3.6 parameters C, U, K are optional. Parameters do not need to be set in a single line.

  - In RRF 3.5 parameters C, U, K are always required. All the parameters should be set in a single line (see SBC example above).

- For a full demonstration, see \>this GitHub repository.

