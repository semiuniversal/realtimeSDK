## M569.1: Stepper driver closed loop configuration

### Parameters

- **Pnn** Motor driver number

- **Tn** Encoder type: 0=none (default), 1=linear quadrature encoder plus Duet3D magnetic shaft encoder (RRF 3.5 and later only), 2=quadrature motor shaft encoder, 3=Duet3D magnetic encoder (RRF 3.5 and later only)

- **Cn.n** In RRF 3.4, for a quadrature motor shaft encoder (T2) this is the number of counts per full step. In RRF 3.5 and later, for a quadrature shaft encoder (T2) or linear composite encoder (T1) it is the number of quadrature encoder pulses per revolution. Not required for a magnetic shaft encoder.

- **En.n:m.m** Error thresholds. If m.m is nonzero then whenever the actual position is more than m.m full motor steps of the desired position, this will be reported as a driver error. If n.n is nonzero and n.n \< m.m then whenever the actual position is more than n.n full steps of the desired position but is less than m.m full steps, this will be reported as a driver warning. (Default: m.m=2.0, n.n=1.0) The action that is taken on a error/warning can be configured using the event system

- **Sn.n** (optional, RRF 3.5 and later only) Motor full steps per revolution, default 200.

- **Rn.n** Proportional constant

- **In.n** (optional) Integral constant

- **Dn.n** (optional) Derivative constant

- **Vn.n** (optional, RRF 3.5 and later only) Velocity feedforward constant

- **An.n** (optional, RRF 3.5 and later only) Acceleration feedforward constant

- **Hn.n** (optional) Minimum holding current as a percentage of the configured motor current when operating in closed loop mode

- **Qn.n** (optional, RRF 3.5 and later only) Motor torque in newton-metres per amp of peak motor current

### Description

Sets the configuration parameters of a closed loop driver. See the M569 D parameter for switching a driver to closed loop after it has been configured.

For RRF 3.4, if you are using a quadrature encoder on the motor shaft, the encoder counts per full step (Cn.n) can be found from the datasheet of the encoder being used. If the value is stated as counts per revolution (CPR), divide by the steps per revolution of the stepper motor to get the count per step. For example, a 1000 CPR encoder attached to a 200 step/rev (1.8 deg/step) motor will have a count per step of 1000 Ã· 200 = 5.

### Notes

- Supported for drivers attached to:

  - Duet 3 Expansion 1HCL boards

- The E parameter defaults to 0.0:0.0 in RRF 3.4.x. **If you do not override this default, then failure to maintain position will not be reported.**

- See Tuning the Duet 3 Expansion 1HCL for further details on setting the proportional/integral/derivative constants.

- The Q parameter is relevant, and required, only when the driver is put into torque mode, see M569.4.

